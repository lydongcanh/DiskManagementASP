
@using Ehr.Models;
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var user = ViewBag.CurUser as User;
    var lsUser = ViewBag.User as List<User>;
}
<style>
    .select2-container .select2-selection--single {
        height: calc(2.25rem + 2px);
        padding: .75rem 1rem;
        border: 1px solid #ced4da;
        display: block;
    }

    .select2-container {
        width: 100% !important;
    }

    .select2-selection__arrow {
        padding-top: 2rem;
    }
</style>
<div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <div class="content-header">
        <div class="card card-default color-palette-box">
            <div class="row card-header" style="border:none;">
                <div class="col-sm-6">
                    <h5>
                        Lịch sử giao dịch
                    </h5>
                </div>
                <div class="col-sm-6">
                    <ol class="breadcrumb float-sm-right">
                        <li class="breadcrumb-item">
                            <a href="#">Trang chủ</a>
                        </li>
                        <li class="breadcrumb-item active">Lịch sử giao dịch</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>
    <!-- /.content-header -->
    <!-- Main content -->
    <section class="content">
        @using (Ajax.BeginForm("Show", "ProductInfor", new AjaxOptions
    {
        InsertionMode = InsertionMode.Replace,
        HttpMethod = "POST",
        LoadingElementId = "ezloader",
        //OnSuccess = "updateOK()",
        // OnFailure = "updateFailed()",
        UpdateTargetId = "allContent"

    }, new { @id = "searchForm" }))
        {
            <div class="card">
                <div class="card-header" style="border-bottom:none !important;">
                    <div class="row">
                        <div class="col-md-4">
                            <select id="province" name="province" class="form-control select2 select2-primary" data-dropdown-css-class="select2-primary">
                                @if (user.IsCentral)
                                {
                                    <option value="0">-- Tất cả tỉnh thành --</option>
                                    <option value="1"> An Giang</option>
                                    <option value="2"> Bà Rịa - Vũng Tàu</option>
                                    <option value="3"> Bắc Giang</option>
                                    <option value="4"> Bắc Kạn</option>
                                    <option value="5"> Bạc Liêu</option>
                                    <option value="6"> Bắc Ninh</option>
                                    <option value="7"> Bến Tre</option>
                                    <option value="8"> Bình Định</option>
                                    <option value="9"> Bình Dương</option>
                                    <option value="10"> Bình Phước</option>
                                    <option value="11"> Bình Thuận</option>
                                    <option value="12"> Cà Mau</option>
                                    <option value="13"> Cần Thơ</option>
                                    <option value="14"> Cao Bằng</option>
                                    <option value="15"> Đà Nẵng</option>
                                    <option value="16"> Đắk Lắk</option>
                                    <option value="17"> Đắk Nông</option>
                                    <option value="18"> Điện Biên</option>
                                    <option value="19"> Đồng Nai</option>
                                    <option value="20"> Đồng Tháp</option>
                                    <option value="21"> Gia Lai</option>
                                    <option value="22"> Hà Giang</option>
                                    <option value="23"> Hà Nam</option>
                                    <option value="24"> Hà Nội</option>
                                    <option value="25"> Hà Tĩnh</option>
                                    <option value="26"> Hải Dương</option>
                                    <option value="27"> Hải Phòng</option>
                                    <option value="28"> Hậu Giang</option>
                                    <option value="29"> Hồ Chí Minh</option>
                                    <option value="30"> Hoà Bình</option>
                                    <option value="31"> Hưng Yên</option>
                                    <option value="32"> Khánh Hòa</option>
                                    <option value="33"> Kiên Giang</option>
                                    <option value="34"> Kon Tum</option>
                                    <option value="35"> Lai Châu</option>
                                    <option value="36"> Lâm Đồng</option>
                                    <option value="37"> Lạng Sơn</option>
                                    <option value="38"> Lào Cai</option>
                                    <option value="39"> Long An</option>
                                    <option value="40"> Nam Định</option>
                                    <option value="41"> Nghệ An</option>
                                    <option value="42"> Ninh Bình</option>
                                    <option value="43"> Ninh Thuận</option>
                                    <option value="44"> Phú Thọ</option>
                                    <option value="45"> Phú Yên</option>
                                    <option value="46"> Quảng Bình</option>
                                    <option value="47"> Quảng Nam</option>
                                    <option value="48"> Quảng Ngãi</option>
                                    <option value="49"> Quảng Ninh</option>
                                    <option value="50"> Quảng Trị</option>
                                    <option value="51"> Sóc Trăng</option>
                                    <option value="52"> Sơn La</option>
                                    <option value="53"> Tây Ninh</option>
                                    <option value="54"> Thái Bình</option>
                                    <option value="55"> Thái Nguyên</option>
                                    <option value="56"> Thanh Hóa</option>
                                    <option value="57"> Thừa Thiên Huế</option>
                                    <option value="58"> Tiền Giang</option>
                                    <option value="59"> Trà Vinh</option>
                                    <option value="60"> Tuyên Quang</option>
                                    <option value="61"> Vĩnh Long</option>
                                    <option value="62"> Vĩnh Phúc</option>
                                    <option value="63"> Yên Bái</option>
                                }
                                else
                                {
                                    <option value="-1"> Chi cục </option>
                                }

                            </select>
                        </div>
                        <div class="col-md-4">
                            <select id="accountid" name="accountid" class="form-control select2 select2-primary" data-dropdown-css-class="select2-primary">
                                @if (!user.IsCentral)
                                {
                                    if (user.UserType == Ehr.Common.Constraint.UserType.LEAD)
                                    {
                                        <option value="0">-- Tất cả người dùng --</option>
                                        foreach (var us in lsUser)
                                        {
                                            if (us.Province == user.Province)
                                            {
                                                <option value="@us.Id">@us.FullName</option>
                                            }
                                        }
                                    }
                                    else
                                    {
                                        <option value="@user.Id">@user.FullName</option>
                                    }
                                }
                                else
                                {
                                    <option value="0">-- Tất cả người dùng --</option>
                                    foreach (var us in lsUser)
                                    {
                                        <option value="@us.Id">@us.FullName</option>
                                    }
                                }
                            </select>
                        </div>
                        <div class="col-md-4">
                            <input type="text" class="form-control my_range" id="RangeSchedule" name="RangeDate" style="min-width:200px;" />
                        </div>
                    </div>
                </div>
                <!-- /.card-body -->
                <div class="card-header">
                    <div class="row">
                        <div class="col-md-4 input-group">

                        </div>
                        <div class="col-md-4 input-group">
                            @Html.TextBox("SearchString", (string)ViewBag.searchValue, new { @class = "form-control", @type = "text", @placeholder = "Tìm kiếm ...", @style = "width:100%;" })
                        </div>
                        <div class="col-md-2 float-right">
                            <div class="input-group-append">
                                <button class="btn btn-success" type="submit" id="doFilter"><i class="fas fa-filter"> &nbsp;Lọc</i></button>

                                <!---Tất cả các tham số lọc đặt ở đây-->
                                <input type="hidden" id="selPage" name="selPage" value="1" />
                                <input type="hidden" id="profileType" name="profileType" value="0" />
                                <input type="hidden" id="sortBy" name="sortBy" />

                            </div>
                        </div>
                        <div class="col-md-2 float-right">
                            <div class="input-group-append float-right">
                                &nbsp;
                                <div class="btn btn-primary" onclick="doProducInforDownload();">
                                    <i class="fas fa-file-excel"></i>&nbsp;Xuất file Excel
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <!-- Default box -->
            <div class="card card-solid">
                <div class="card-header text-sm">
                    <div class="card-title" style="font-size:12pt !important;">
                        <div class="input-group input-group-sm">

                        </div>
                    </div>
                    <div class="card-tools">
                        <div class="input-group input-group-sm btn-group btn-group-toggle" data-toggle="buttons">
                            <h6 class="pt-2">hiển thị </h6>&nbsp;
                            <select id="numItems" name="numItems" onchange="updateSize();" style="height:1.3rem;border-radius:5px;" class="mt-2">
                                <option value="12">12</option>
                                <option value="24">24</option>
                                <option value="36">36</option>
                                <option value="60">60</option>
                            </select>
                            &nbsp;&nbsp;
                            &nbsp;&nbsp;
                        </div>
                    </div>
                    <!-- /.card-tools -->
                </div>
                <div id="allContent">

                </div>
                <!-- /.card-body -->
            </div>
            <!-- /.card -->


        }
    </section>
    <!-- /.content -->
</div>
<div id="ezloader" style="display:none;position:absolute;top:45%;left:45%;padding:5px;">
    <img width="75px" height="75px" src="~/Content/img/loading6.gif" />
</div>
@Scripts.Render("~/Scripts/validation/msgbox.js")
@Scripts.Render("~/Scripts/validation/screening.js")
<script src="~/Content/admin-lte/plugins/moment/moment.min.js"></script>
<script src="~/Content/admin-lte/plugins/daterangepicker/daterangepicker.js"></script>
@Scripts.Render("~/Content/admin-lte/plugins/datatables/jquery.dataTables.min.js")
@Scripts.Render("~/Content/admin-lte/plugins/datatables-bs4/js/dataTables.bootstrap4.js")
@Styles.Render("~/Content/admin-lte/plugins/datatables-bs4/css/dataTables.bootstrap4.css")
<script>
    var flag = "/ProductInfor/Index";
</script>
<script>
    
    $("#province").change(function () {
        $('#accountid').find('option').not(':first').remove();
        fetch(window.location.origin + "/ProductInfor/LoadUserByProvince?province=" + $("#province").val())
            .then(res => res.json())
            .then(data => {
                $("#accountid").select2({
                    tokenSeparators: [","],
                    multiple: false,
                    miniumInputLength: 2,
                    data: data
                });
            });
    });
    $("#RangeSchedule").daterangepicker(
        {
            ranges: {
                'Today': [moment(), moment()],
                'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
                'Last 7 Days': [moment().subtract(6, 'days'), moment()],
                'Last 30 Days': [moment().subtract(29, 'days'), moment()],
                'This Month': [moment().startOf('month'), moment().endOf('month')],
                'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
            },
            startDate: moment().subtract(29, 'days'),
            endDate: moment(),
            locale: {
                format: 'DD/MM/YY'
            }
        },
        function (start, end) {
            $('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'))

        }
    );
    $("#doFilter").submit();
</script>